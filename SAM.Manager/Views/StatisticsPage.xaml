<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="SAM.Manager.Views.StatisticsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SAM.Manager.Views"
    xmlns:models="using:SAM.Core.Models"
    NavigationCacheMode="Disabled">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Margin="0,0,0,16">
            <TextBlock x:Name="GameNameText"
                       Text="Statistiken" 
                       Style="{StaticResource TitleLargeTextBlockStyle}"/>
            <TextBlock x:Name="GameSubtitleText"
                       Style="{StaticResource BodyTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- Command Bar -->
        <CommandBar Grid.Row="1" 
                    DefaultLabelPosition="Right"
                    Background="Transparent">
            <AppBarButton Icon="Refresh" 
                          Label="Aktualisieren" 
                          Click="RefreshButton_Click"/>
            <AppBarButton Icon="Save" 
                          Label="Speichern" 
                          Click="SaveButton_Click">
                <AppBarButton.KeyboardAccelerators>
                    <KeyboardAccelerator Modifiers="Control" Key="S"/>
                </AppBarButton.KeyboardAccelerators>
            </AppBarButton>
            <AppBarSeparator/>
            <AppBarButton Label="Alle zurücksetzen" 
                          Click="ResetAllButton_Click">
                <AppBarButton.Icon>
                    <FontIcon Glyph="&#xE74D;"/>
                </AppBarButton.Icon>
            </AppBarButton>
        </CommandBar>

        <!-- Stats List -->
        <ListView x:Name="StatsListView"
                  Grid.Row="2"
                  SelectionMode="None">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:StatModel">
                    <Grid Padding="12"
                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1"
                          CornerRadius="8"
                          Margin="0,4"
                          ColumnSpacing="16">
                        
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Stat Info -->
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="{x:Bind DisplayName}" 
                                       Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <TextBlock Text="{x:Bind Id}" 
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       IsTextSelectionEnabled="True"/>
                        </StackPanel>

                        <!-- Value Input -->
                        <Grid Grid.Column="1" VerticalAlignment="Center">
                            <TextBox Text="{x:Bind StringValue, Mode=TwoWay}"
                                     Width="180"
                                     HorizontalAlignment="Right"
                                     TextChanged="ValueTextBox_TextChanged"/>
                        </Grid>

                        <!-- Modified Indicator -->
                        <Border Grid.Column="2"
                                Background="{ThemeResource SystemFillColorCautionBackgroundBrush}"
                                CornerRadius="4"
                                Padding="8,4"
                                VerticalAlignment="Center"
                                Visibility="{x:Bind IsModified, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="Geändert" 
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource SystemFillColorCautionBrush}"/>
                        </Border>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Status Bar -->
        <InfoBar x:Name="StatusInfoBar"
                 Grid.Row="3"
                 IsOpen="False"
                 Severity="Informational"
                 Title="Status"/>

        <!-- Loading Overlay -->
        <Grid x:Name="LoadingOverlay"
              Grid.RowSpan="4"
              Visibility="Collapsed"
              Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}">
            <StackPanel HorizontalAlignment="Center" 
                        VerticalAlignment="Center"
                        Spacing="16">
                <ProgressRing IsActive="True" Width="48" Height="48"/>
                <TextBlock Text="Statistiken werden geladen..." 
                           Style="{StaticResource BodyTextBlockStyle}"/>
            </StackPanel>
        </Grid>

        <!-- Empty State -->
        <StackPanel x:Name="EmptyState"
                    Grid.Row="2"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Visibility="Collapsed">
            <FontIcon Glyph="&#xE9D9;" FontSize="64" 
                      Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            <TextBlock Text="Keine Statistiken verfügbar" 
                       Style="{StaticResource SubtitleTextBlockStyle}"
                       HorizontalAlignment="Center"
                       Margin="0,16,0,0"/>
            <TextBlock Text="Dieses Spiel hat keine bearbeitbaren Statistiken."
                       Style="{StaticResource BodyTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       HorizontalAlignment="Center"/>
        </StackPanel>
    </Grid>
</Page>
